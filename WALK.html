<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>歩数</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }
    h1, h2 {
      color: #333;
    }
    form {
      margin-bottom: 20px;
    }
    input[type="number"] {
      padding: 5px;
      font-size: 16px;
      width: 120px;
    }
    input[type="submit"] {
      padding: 5px 10px;
      font-size: 16px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    .simulation {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #aaa;
      background-color: #f9f9f9;
    }
  </style>
</head>
<body>

  <form id="stepForm">
    <label for="steps">現在の歩数:</label>
    <input type="number" id="steps" name="steps" min="0" required>
    <input type="submit" value="記録">
  </form>

  <div class="simulation">
    <h2>シミュレーション結果</h2>
    <p id="rateDisplay">1分あたりの増加歩数: N/A</p>
    <p id="estimateDisplay">10000歩到達推定時刻: N/A</p>
  </div>

  <h2>記録ログ</h2>
  <table id="logTable">
    <thead>
      <tr>
        <th>記録時刻</th>
        <th>歩数</th>
        <th>前回との差（分）</th>
        <th>1分あたりの増加</th>
      </tr>
    </thead>
    <tbody>
      <!-- ログ行が追加されます -->
    </tbody>
  </table>

  <script>
    // ログの配列（各要素は { time: Date, steps: number }）
    const logs = [];

    // HTML要素の取得
    const form = document.getElementById('stepForm');
    const stepsInput = document.getElementById('steps');
    const logTableBody = document.querySelector('#logTable tbody');
    const rateDisplay = document.getElementById('rateDisplay');
    const estimateDisplay = document.getElementById('estimateDisplay');

    form.addEventListener('submit', function(e) {
      e.preventDefault();

      // 入力値を取得し、現在時刻と共にログに記録
      const steps = parseInt(stepsInput.value, 10);
      const currentTime = new Date();
      const newLog = { time: currentTime, steps: steps };
      logs.push(newLog);

      // ログテーブルの更新
      updateLogTable();

      // シミュレーション結果の更新（累計データ基準）
      updateSimulation();

      // 入力欄をクリア
      stepsInput.value = '';
    });

    function updateLogTable() {
      // テーブルをクリア
      logTableBody.innerHTML = '';

      // 最新ログを最上部に表示するため、配列を逆順にループ
      for (let i = logs.length - 1; i >= 0; i--) {
        const log = logs[i];
        const row = document.createElement('tr');

        // 記録時刻
        const timeCell = document.createElement('td');
        timeCell.textContent = log.time.toLocaleTimeString();
        row.appendChild(timeCell);

        // 歩数
        const stepsCell = document.createElement('td');
        stepsCell.textContent = log.steps;
        row.appendChild(stepsCell);

        // 前回との差（分）と1分あたりの増加を計算
        // 最新ログの場合は次のログが存在する場合のみ計算
        let diffTime = 'N/A';
        let ratePerMinute = 'N/A';
        if (i < logs.length - 1) {
          const nextLog = logs[i + 1];
          const diffMs = nextLog.time - log.time;
          const diffMinutes = diffMs / 60000;
          diffTime = diffMinutes.toFixed(2);
          if (diffMinutes > 0) {
            ratePerMinute = ((nextLog.steps - log.steps) / diffMinutes).toFixed(2);
          }
        }
        const diffCell = document.createElement('td');
        diffCell.textContent = diffTime;
        row.appendChild(diffCell);

        const rateCell = document.createElement('td');
        rateCell.textContent = ratePerMinute;
        row.appendChild(rateCell);

        logTableBody.appendChild(row);
      }
    }

    function updateSimulation() {
      // 累計データを利用するため、最低2件のログが必要
      if (logs.length < 2) {
        rateDisplay.textContent = "1分あたりの増加歩数: N/A (ログを2回以上記録してください)";
        estimateDisplay.textContent = "10000歩到達推定時刻: N/A";
        return;
      }

      // 最初の記録は古い順に並んだ最初の要素
      const firstLog = logs[0];
      // 最新のログは配列の最後の要素
      const latestLog = logs[logs.length - 1];

      // 全体の経過時間（分）と歩数増加を計算
      const totalDiffMs = latestLog.time - firstLog.time;
      const totalMinutes = totalDiffMs / 60000;
      const totalStepsGained = latestLog.steps - firstLog.steps;

      let avgRate = 0;
      if (totalMinutes > 0) {
        avgRate = totalStepsGained / totalMinutes;
      }

      rateDisplay.textContent = "1分あたりの増加歩数: " + avgRate.toFixed(2);

      // 残りの歩数と所要分数の計算
      const remainingSteps = 10000 - latestLog.steps;
      let estimatedMinutes = 0;
      if (avgRate > 0) {
        estimatedMinutes = remainingSteps / avgRate;
      }

      // 推定時刻の算出
      const estimatedTime = new Date(latestLog.time.getTime() + estimatedMinutes * 60000);
      const options = { hour: '2-digit', minute: '2-digit', second: '2-digit' };
      const estimatedTimeString = estimatedTime.toLocaleTimeString([], options);

      estimateDisplay.textContent = "10000歩到達推定時刻: " + estimatedTimeString + "（約" + estimatedMinutes.toFixed(2) + "分後）";
    }
  </script>
</body>
</html>
